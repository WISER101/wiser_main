<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="X-Frame-Options" content="DENY">
  <meta name="referrer" content="strict-origin-when-cross-origin">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard â€” Wiser</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/base.css">
  <link rel="stylesheet" href="../css/app.css">
  <link rel="stylesheet" href="../css/admin.css">
  <script>(function(){var t=localStorage.getItem('wiser_theme');if(t==='dark')document.documentElement.setAttribute('data-theme','dark')})()</script>
</head>
<body>
  <div class="app-layout">
    <!-- Admin Sidebar -->
    <aside class="sidebar admin-sidebar">
      <div class="sidebar-logo">
        <a href="dashboard.html">
          <img src="../assets/logo-Light-Theme.png" alt="Wiser" class="logo-icon logo-light"><img src="../assets/Logo-Dark-Theme.png" alt="Wiser" class="logo-icon logo-dark">
        </a>
        <span class="admin-badge">Admin</span>
      </div>

      <nav class="sidebar-nav">
        <div class="sidebar-nav-label">Overview</div>
        <a href="dashboard.html" class="sidebar-link active">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
          Dashboard
        </a>
        <a href="users.html" class="sidebar-link">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
          Users
        </a>

        <div class="sidebar-nav-label">Content</div>
        <a href="courses.html" class="sidebar-link">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
          Courses
        </a>
        <a href="reports.html" class="sidebar-link">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
          Reports
        </a>

        <div class="sidebar-nav-label">Finance</div>
        <a href="revenue.html" class="sidebar-link">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
          Revenue
        </a>

        <div class="sidebar-nav-label">System</div>
        <a href="settings.html" class="sidebar-link">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
          Settings
        </a>
      </nav>

      <div class="sidebar-user">
        <div class="avatar avatar-sm" style="background: linear-gradient(135deg, #DC2626, #5ab82e)">A</div>
        <div class="sidebar-user-info">
          <span class="sidebar-user-name">Admin</span>
          <span class="sidebar-user-role">Super Admin</span>
        </div>
      </div>
    </aside>

    <div class="sidebar-overlay" onclick="document.body.classList.remove('sidebar-open')"></div>

    <!-- Main Content -->
    <main class="main-content">
      <header class="top-header">
        <button class="sidebar-toggle" onclick="document.body.classList.toggle('sidebar-open')">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
        </button>
        <h2 class="page-title">Admin Dashboard</h2>
        <div style="flex:1"></div>
        <div class="header-actions">
          <button class="theme-toggle" onclick="ThemeManager.toggle()" aria-label="Toggle dark mode" style="background:none;border:none;cursor:pointer;padding:6px;"><svg class="icon-moon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg><svg class="icon-sun" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button>
          <div class="admin-server-status">
            <span class="status-dot online"></span>
            <span>All systems operational</span>
          </div>
          <button class="icon-btn" onclick="WiserAuth.logout()" title="Logout">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
          </button>
        </div>
      </header>

      <div class="page-content">
        <!-- Welcome Banner -->
        <div class="admin-welcome-banner">
          <div class="admin-welcome-text">
            <h1>Welcome back, Admin</h1>
            <p>Here's what's happening on Wiser today.</p>
          </div>
          <div class="admin-welcome-date" id="currentDate"></div>
        </div>

        <!-- KPI Stats -->
        <div class="admin-stats-grid">
          <div class="admin-stat-card">
            <div class="admin-stat-icon" style="background: rgba(61,139,28,0.1); color: #3d8b1c;">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
            </div>
            <div class="admin-stat-info">
              <div class="admin-stat-value" data-count="52847">0</div>
              <div class="admin-stat-label">Total Users</div>
            </div>
            <div class="admin-stat-trend positive">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
              +12.5%
            </div>
          </div>

          <div class="admin-stat-card">
            <div class="admin-stat-icon" style="background: rgba(90,184,46,0.1); color: #5ab82e;">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
            </div>
            <div class="admin-stat-info">
              <div class="admin-stat-value" data-count="1284">0</div>
              <div class="admin-stat-label">Active Courses</div>
            </div>
            <div class="admin-stat-trend positive">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
              +8.3%
            </div>
          </div>

          <div class="admin-stat-card">
            <div class="admin-stat-icon" style="background: rgba(159,232,112,0.1); color: #9fe870;">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
            </div>
            <div class="admin-stat-info">
              <div class="admin-stat-value" data-count="284590" data-prefix="$">0</div>
              <div class="admin-stat-label">Monthly Revenue</div>
            </div>
            <div class="admin-stat-trend positive">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
              +23.1%
            </div>
          </div>

          <div class="admin-stat-card">
            <div class="admin-stat-icon" style="background: rgba(159,232,112,0.1); color: #9fe870;">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
            </div>
            <div class="admin-stat-info">
              <div class="admin-stat-value" data-count="94" data-suffix="%">0</div>
              <div class="admin-stat-label">Platform Uptime</div>
            </div>
            <div class="admin-stat-trend neutral">99.9% SLA</div>
          </div>
        </div>

        <!-- Charts Row -->
        <div class="admin-grid-2">
          <!-- Revenue Chart -->
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Revenue Overview</h3>
              <select class="form-select form-select-sm" id="revenueRange" onchange="updateRevenueChart()">
                <option value="7d">Last 7 days</option>
                <option value="30d" selected>Last 30 days</option>
                <option value="90d">Last 90 days</option>
              </select>
            </div>
            <div class="admin-chart-container">
              <canvas id="revenueChart"></canvas>
            </div>
          </div>

          <!-- User Growth Chart -->
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">User Growth</h3>
              <div class="admin-chart-legend">
                <span class="legend-item"><span class="legend-dot" style="background:#3d8b1c"></span> Students</span>
                <span class="legend-item"><span class="legend-dot" style="background:#5ab82e"></span> Teachers</span>
              </div>
            </div>
            <div class="admin-chart-container">
              <canvas id="userChart"></canvas>
            </div>
          </div>
        </div>

        <!-- Tables Row -->
        <div class="admin-grid-2">
          <!-- Recent Users -->
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Recent Users</h3>
              <a href="users.html" class="btn btn-ghost btn-sm">View All</a>
            </div>
            <div class="admin-table-wrap">
              <table class="data-table" id="recentUsersTable">
                <thead>
                  <tr>
                    <th>User</th>
                    <th>Role</th>
                    <th>Joined</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>

          <!-- Top Courses -->
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Top Courses</h3>
              <a href="courses.html" class="btn btn-ghost btn-sm">View All</a>
            </div>
            <div class="admin-table-wrap">
              <table class="data-table" id="topCoursesTable">
                <thead>
                  <tr>
                    <th>Course</th>
                    <th>Instructor</th>
                    <th>Students</th>
                    <th>Revenue</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Bottom Row -->
        <div class="admin-grid-3">
          <!-- Quick Actions -->
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Quick Actions</h3>
            </div>
            <div class="admin-quick-actions">
              <button class="admin-action-btn" onclick="showModal('addUserModal')">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/></svg>
                <span>Add User</span>
              </button>
              <button class="admin-action-btn" onclick="showModal('courseModal')">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                <span>Review Course</span>
              </button>
              <button class="admin-action-btn" onclick="showModal('announcementModal')">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                <span>Announcement</span>
              </button>
              <button class="admin-action-btn" onclick="exportReport()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                <span>Export Report</span>
              </button>
            </div>
          </div>

          <!-- Platform Activity -->
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Recent Activity</h3>
            </div>
            <div class="admin-activity-feed" id="activityFeed"></div>
          </div>

          <!-- Pending Approvals -->
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Pending Approvals</h3>
              <span class="badge badge-warning" id="pendingCount">5</span>
            </div>
            <div class="admin-pending-list" id="pendingList"></div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Add User Modal -->
  <div class="admin-modal-overlay" id="addUserModal">
    <div class="admin-modal">
      <div class="admin-modal-header">
        <h3>Add New User</h3>
        <button class="admin-modal-close" onclick="hideModal('addUserModal')">&times;</button>
      </div>
      <div class="admin-modal-body">
        <div class="form-group">
          <label class="form-label">Full Name</label>
          <input type="text" class="form-input" placeholder="Enter full name" id="newUserName">
        </div>
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" class="form-input" placeholder="user@example.com" id="newUserEmail">
        </div>
        <div class="form-group">
          <label class="form-label">Role</label>
          <select class="form-select" id="newUserRole">
            <option value="student">Student</option>
            <option value="teacher">Teacher</option>
            <option value="admin">Admin</option>
          </select>
        </div>
      </div>
      <div class="admin-modal-footer">
        <button class="btn btn-ghost" onclick="hideModal('addUserModal')">Cancel</button>
        <button class="btn btn-primary" onclick="addUser()">Add User</button>
      </div>
    </div>
  </div>

  <!-- Course Review Modal -->
  <div class="admin-modal-overlay" id="courseModal">
    <div class="admin-modal">
      <div class="admin-modal-header">
        <h3>Review Course</h3>
        <button class="admin-modal-close" onclick="hideModal('courseModal')">&times;</button>
      </div>
      <div class="admin-modal-body">
        <p style="color: var(--text-secondary); margin-bottom: var(--space-4);">Select a course from the pending list or navigate to the Courses page for full review.</p>
        <div class="form-group">
          <label class="form-label">Course ID</label>
          <input type="text" class="form-input" placeholder="e.g. CRS-0042" id="reviewCourseId">
        </div>
        <div class="form-group">
          <label class="form-label">Decision</label>
          <select class="form-select" id="reviewDecision">
            <option value="approve">Approve</option>
            <option value="reject">Reject</option>
            <option value="revision">Request Revision</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Notes</label>
          <textarea class="form-input" rows="3" placeholder="Add review notes..." id="reviewNotes"></textarea>
        </div>
      </div>
      <div class="admin-modal-footer">
        <button class="btn btn-ghost" onclick="hideModal('courseModal')">Cancel</button>
        <button class="btn btn-primary" onclick="submitReview()">Submit Review</button>
      </div>
    </div>
  </div>

  <!-- Announcement Modal -->
  <div class="admin-modal-overlay" id="announcementModal">
    <div class="admin-modal">
      <div class="admin-modal-header">
        <h3>Send Announcement</h3>
        <button class="admin-modal-close" onclick="hideModal('announcementModal')">&times;</button>
      </div>
      <div class="admin-modal-body">
        <div class="form-group">
          <label class="form-label">Target Audience</label>
          <select class="form-select" id="announcementTarget">
            <option value="all">All Users</option>
            <option value="students">Students Only</option>
            <option value="teachers">Teachers Only</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Title</label>
          <input type="text" class="form-input" placeholder="Announcement title" id="announcementTitle">
        </div>
        <div class="form-group">
          <label class="form-label">Message</label>
          <textarea class="form-input" rows="4" placeholder="Write your announcement..." id="announcementMsg"></textarea>
        </div>
      </div>
      <div class="admin-modal-footer">
        <button class="btn btn-ghost" onclick="hideModal('announcementModal')">Cancel</button>
        <button class="btn btn-primary" onclick="sendAnnouncement()">Send</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="admin-toast" id="toast"></div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.49.2/dist/umd/supabase.min.js" integrity="sha384-zhtfJ1S/qkpAToBl4XpbM2NH5uZgfUq2z4qo30Ed7TxgPxmkM+L1Gm94iyexzcJ6" crossorigin="anonymous"></script>
    <script src="../js/supabase-config.js"></script>
    <script src="../js/api.js"></script>
    <script src="../js/data.js"></script>
    <script src="../js/admin.js"></script>
<script>if(typeof ThemeManager==='undefined'){var ThemeManager={toggle:function(){var c=document.documentElement.getAttribute('data-theme')||'light';var n=c==='dark'?'light':'dark';document.documentElement.setAttribute('data-theme',n);localStorage.setItem('wiser_theme',n);document.querySelectorAll('.theme-toggle').forEach(function(b){var s=b.querySelector('.icon-sun');var m=b.querySelector('.icon-moon');if(s&&m){s.style.display=n==='dark'?'block':'none';m.style.display=n==='dark'?'none':'block'}});document.querySelectorAll('.logo-light').forEach(function(e){e.style.display=n==='dark'?'none':'block'});document.querySelectorAll('.logo-dark').forEach(function(e){e.style.display=n==='dark'?'block':'none'})}}}</script>
</body>
</html>
